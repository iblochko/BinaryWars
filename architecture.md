# Разработка архитектуры

1. Тип приложения - компьютерная игра жанра пошаговая стратегия.
2. Игра для компьютеров на Windows
3. Выбран инструмент разработки игр Godot, так как он легковесен, имеет открытый исходный код и распространяется по свободной лицензии и имеет большой функционал.
4.
    - Производительность (стабильные 60 FPS).
	- Отклик ввода (минимальная задержка).
	- Расширяемость (легкость добавления новых уровней/врагов).
	- Надежность (отсутствие критических вылетов).
5. 
	- Как будет реализовано сохранение прогресса (например, через `ResourceSaver` или JSON).
	- Логирование ошибок.
	- Управление состояниями игры (Меню -> Игра -> Пауза -> Game Over).

## Архитектура "To be"

![Architecture To be](https://github.com/user-attachments/assets/52665fa3-6a55-4a32-b762-6611c4f2c5bb)

## Архитектура "As is"

![Architecture As is](https://github.com/user-attachments/assets/7bb2d80f-8c18-47c9-b1ae-707eae60fb67)

## Сравнение

| **Критерий сравнения** | **Архитектура «As is»** | **Архитектура «To be»** |
|------------------------|-------------------------|-------------------------|
| **Уровень абстракции** | Классы и их атрибуты (UML-диаграмма) | Функциональные слои и компоненты |
| **Архитектурный подход** | Node-based архитектура Godot (сцены и узлы) | Многослойная архитектура (Layered Architecture) |
| **Организация кода** | Сцены как контейнеры логики и представления | Разделение на Presentation, Logic, Network, Data слои |
| **Сетевая модель** | Базовая настройка peer-to-peer соединения | P2P с Multiplayer API, RPC-методами, менеджерами соединения |
| **Управление состоянием** | Локальное хранение в узлах-владельцах | Централизованный GameStateManager + локальные кэши |
| **Обработка ввода** | Встроена в сцены юнитов и UI | Выделенный Input Handler в слое представления |
| **Валидация действий** | Локальная проверка в методах юнитов | Выделенный компонент Move Validator |
| **Сохранение данных** | Не реализовано на текущем этапе | Data Layer с механизмами Save/Load, конфигурации, логирования |
| **Взаимодействие компонентов** | Прямые ссылки между узлами дерева сцен | Сигналы Godot + слабая связность между слоями |
| **Масштабируемость** | Ограничена плоской структурой сцен | Высокая за счёт модульности и разделения ответственности |

---

## Анализ отличий и их причин

### **Различие в архитектурном подходе: Godot vs. Традиционные приложения**

**Суть отличия:**
- Архитектура «As is» отражает **node-based парадигму Godot**, где логика, представление и данные инкапсулированы в сценах и узлах
- Архитектура «To be» описывает **классическую многослойную модель**, характерную для enterprise-приложений

**Причины различий:**
1. **Специфика игровых движков**: Godot использует композицию узлов (scenes/nodes) как основной способ организации кода, что отличается от традиционного ООП-подхода с чётким разделением слоёв
2. **Этап разработки**: На текущем этапе (первый Sprint Review) приоритет отдан быстрой реализации механик, а не архитектурной чистоте
3. **Образовательный контекст**: Изучение возможностей Godot происходит параллельно с разработкой, что естественно влияет на эволюцию архитектуры

**Вывод**: Отличия обусловлены не ошибками проектирования, а особенностями предметной области (game development) и инструмента (Godot Engine).

---

### **Организация сетевой архитектуры**

**Суть отличия:**
- «As is»: Базовая конфигурация P2P-соединения через свойства `my_ip`, `other_ip`, `host`
- «To be»: Выделенный Network Layer с менеджерами соединения, RPC-обработчиками и механизмами синхронизации

**Причины различий:**
1. **Поэтапная реализация**: Сетевая функциональность запланирована на поздние спринты (Sprint 5), текущая реализация служит прототипом
2. **Сложность P2P**: Полноценная реализация требует учёта NAT traversal, обработки разрывов соединения, синхронизации состояния — эти аспекты добавляются по мере необходимости
3. **Инструментарий Godot**: Multiplayer API движка предоставляет высокоуровневые абстракции, которые интегрируются в архитектуру постепенно

---

### **Управление состоянием игры**

**Суть отличия:**
- «As is»: Состояние распределено между узлами сцены (Game, Map, player)
- «To be»: Централизованный GameStateManager + локальные кэши в компонентах

**Причины различий:**
1. **Node-based подход Godot**: Естественная организация данных через дерево сцен, где каждый узел управляет своей частью состояния
2. **Прототипирование**: Для проверки механик достаточно локального хранения данных
3. **Эволюция архитектуры**: По мере усложнения игры возникает потребность в централизованном управлении состоянием для синхронизации и отладки

---

### **Отсутствие Data Layer на текущем этапе**

**Суть отличия:**
- «As is»: Механизмы сохранения, конфигурации и логирования не реализованы
- «To be»: Выделенный Data Layer с поддержкой Save/Load, конфигурационных файлов, логирования действий

**Причины различий:**
1. **Приоритеты разработки**: На ранних этапах фокус смещён на базовые игровые механики
2. **Планирование функциональности**: Сохранение прогресса и настройка запланированы на финальные спринты
3. **Возможности Godot**: Движок предоставляет встроенные классы (ConfigFile, JSON, FileAccess), которые интегрируются по мере необходимости

---

## Пути улучшения архитектуры

### **Адаптация принципов проектирования под Godot**

**Принцип единственной ответственности (SRP) в контексте сцен:**
- **Подход**: Каждая сцена отвечает за одну функциональную область (юнит, здание, UI-элемент)
- **Реализация**: Использование наследования сцен и композиции узлов для разделения логики

**Принцип открытости/закрытости (OCP) через ресурсы Godot:**
- **Подход**: Использование Resource-файлов для конфигурации юнитов, зданий, улучшений CPU
- **Преимущество**: Добавление новых типов не требует изменения базовых скриптов

**Принцип инверсии зависимостей (DIP) через сигналы:**
- **Подход**: Взаимодействие компонентов через сигналы Godot вместо прямых ссылок
- **Преимущество**: Снижение связности, упрощение тестирования и замены компонентов

---


### **Развитие сетевой архитектуры**

**Этапы реализации P2P-синхронизации:**
1. Базовое соединение (текущий этап)
2. Синхронизация игрового состояния через RPC-методы
3. Обработка задержек и рассинхронизации (checksum, периодическая верификация)
4. Механизмы восстановления соединения и миграции хоста

**Интеграция с Godot Multiplayer API:**
- Использование аннотаций `@rpc` для декларативного описания сетевых вызовов
- Разделение логики на авторитетную (сервер/хост) и клиентскую части
- Синхронизация через встроенные механизмы движка

---

## Выводы

### **Учитывая, что проект находится в активной разработке:**

1. **Текущие архитектурные решения обоснованы**:
   - Ранний этап проекта (первый Sprint Review)
   - Фокус на проверке концепции и базовых механик Binary Wars
   - Параллельное изучение возможностей Godot Engine
   - Ограниченные временные рамки спринта

2. **Эволюция архитектуры запланирована и реалистична**:
   - Поэтапное внедрение улучшений в рамках спринтов 2–7
   - Приоритизация критических компонентов (менеджеры, сетевой слой)
   - Сохранение работоспособности на каждом этапе рефакторинга
   - Возможность параллельной разработки новых функций и улучшения архитектуры

3. **Рекомендации для команды**:
   - Начать выделение менеджеров после завершения Sprint 1
   - Выделять 20–30% времени каждого спринта на архитектурные улучшения
   - Использовать Code Review для контроля качества и распространения знаний
   - Вести учёт технического долга в backlog и приоритизировать его совместно с новыми функциями
   - Документировать архитектурные решения в README проекта для новых участников команды

### **Итоговая оценка:**

Выявленные отличия между «As is» и «To be» отражают не недостатки, а **эволюцию программного продукта** от начального прототипа к масштабируемому решению. Предложенный план рефакторинга учитывает специфику Godot Engine, образовательный контекст проекта и ограничения по времени, обеспечивая баланс между быстрым развитием функциональности и поддержанием качества архитектуры.

**Архитектурное решение считается обоснованным**, а выявленные направления улучшения — приоритетными для следующих этапов разработки.
